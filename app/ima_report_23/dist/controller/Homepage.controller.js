sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/CustomData","sap/ui/model/json/JSONModel","sap/ui/table/Table","sap/ui/table/RowSettings","sap/ui/table/Column","sap/m/Text","sap/ui/core/Item","sap/m/ObjectAttribute","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/util/ExportTypeCSV"],function(e,t,o,n,r,i,l,a,s,c,d){"use strict";return e.extend("imareport23.controller.Homepage",{onInit:function(){var e=new o;this.getView().setModel(new o,"selectedFiltersModel");this.getView().setModel(new o,"DataIMA23");let t=this.getView().getModel("selectedFiltersModel");t.setProperty("/matchData",false);this._createFiltersModel();this.getView().setModel(e,"repo23Model")},_createFiltersModel:function(){let e=new o({Entity:null,TipoContratto:null,Contratto:null,Anno:null,Periodo:null,CostCenter:null,Id_storico:null,CompanyCode:null});this.getView().setModel(e,"oFiltersModel")},_elaboratedMonths:function(e){const t=["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"];return e.map(e=>parseInt(e,10)).sort((e,t)=>e-t).map(e=>({ID:e.toString().padStart(3,"0"),description:t[e-1]}))},_getDataFilters:function(){const e=`${this.osUrl}Filters`;axios.post(e).then(e=>{console.log(e.data);let t=this.getView().getModel("oFiltersModel");t.setData({Entity:this._elaborateEntities(e.data.BUKRS,e.data.BUTXT),TipoContratto:this._sortStringArray(e.data.RECNTYPE),Contratto:this._sortStringArray(e.data.RECNNR),Periodo:this._elaboratedMonths(e.data.PERIODDUEDATE),Anno:this._sortStringArray(e.data.YEARDUEDATE),CostCenter:this._sortStringArray(e.data.CDC),Id_storico:this._sortStringArray(e.data.ID_STORICO)});console.log("Filters data: ",t.getData());return}).catch(e=>{console.error(e);if(e.response){console.error("Server responded with error: ",e.response.status,e.response.data)}else if(e.request){console.error("No response received from server: ",e.request)}else{console.error("Axios error: ",e.message)}})},_initializeTables:function(){var e=this.getview().getModel("repo23Model").getData()},onAfterRendering:function(){this.addEmptyToSelect();this.makeTitleObjAttrBold()},addEmptyToSelect:function(){const e=this.getView();const t=["scenarioSelection","entitySelection","yearSelection","periodSelection","icpSelection","lease_nSelection","costCenterSelection"];t.forEach(t=>{const o=e.byId(t);o.insertItem(new a({key:"",text:""}),0);o.setSelectedKey("")})},_createDynamicTable:function(e){var t=this.getView().byId("reportTable");t.removeAllColumns();var n=[{label:"Journal Type",property:"journalType",width:"200px"},{label:"Account",property:"account",width:"230px"},{label:"Debit",property:"debit",width:"150px"},{label:"Credit",property:"credit",width:"150px"}];n.forEach(e=>{t.addColumn(new i({label:new l({text:e.label}),template:(new l).bindText(e.property),width:e.width}))});var r=new o({tableRows:e});t.setModel(r);t.bindRows("/tableRows");this.setTableHeight(null,t);this._colorTotalRows()},onSelectionChange:function(e){this.assignReportResume(e);this.makeTitleObjAttrBold();let t=this.getView().getModel("selectedFiltersModel");let o=t.getData();const n=e.getSource();const r=n.getName();if(n.getMetadata().getName()==="sap.m.MultiComboBox"){o[r]=n.getSelectedKeys()}else{o[r]=n.getSelectedKey()}t.setData(o);let i=o.Periodo&&o.Anno&&o.ID_STORICO&&(o.TipoContratto&&o.TipoContratto.length>0)&&(o.Entity&&o.Entity.length>0)?true:false;t.setProperty("/allSelected",i)},assignReportResume:function(e){const t=e.getSource();const o=t?t.getName():"";const n=t.getSelectedItem().getText();const r=this.getView().byId("hLayout");const i=r.getContent();i.forEach(e=>{const t=e.getContent();t.forEach(e=>{if(e instanceof s){if(e.getTitle().toLowerCase()===o.toLowerCase()){e.setText(n);e.rerender()}}})})},applyFilters:function(){const e=this.getView().byId("tableContainer").getItems()[0];const t=[];this.filterArray.forEach(e=>{const o=Object.keys(e)[0];const n=e[o];if(n){let e=new c({path:o,value1:n,FilterOperator:d.EQ});t.push(e)}});const o=new c({filters:t,and:true});const n=e.getBinding("rows");n.filter(o)},_colorTotalRows:function(){var e=this.getView().byId("tableContainer").getItems()[0];var t=function(){var t=e.getRows();var o=false;t.forEach(function(e){var t=e.getBindingContext();var n=e._mDomRefs.jQuery.row[0];if(t&&n){var r=t.getProperty("journalType");if(r===" "){o=true}else{o=false}if(o){$(n).addClass("highlightRow")}else{$(n).removeClass("highlightRow")}}})};e.attachEvent("rowsUpdated",t);t()},onCloseLegend:function(e){var t=this.byId("legendPanel");t.setVisible(false)},enableDownloadButtons:function(e,t){const o=this.getView().byId("excelBtn");const n=this.getView().byId("pdfBtn");o.setEnabled(t);n.setEnabled(t)},onSearch:function(){var e=this.byId("entitySelection").getSelectedKey();var t=this.byId("periodSelection").getSelectedKey();var o=this.byId("yearSelection").getSelectedKey();var n=this.byId("scenarioSelection").getSelectedKey();var r=this.byId("icpSelection").getSelectedKey();var i=this.byId("lease_nSelection").getSelectedKey();var l=this.byId("costCenterSelection").getSelectedKey();var a=this.byId("tableContainer");var s=this.getView().getModel("repo23Model").getData();var c=s.filter(function(a){console.log(a.Lease_N);return a.Entity==e&&a.Period==t&&a.Year==o&&a.Scenario==n&&a.Icp==r&&a.Lease_N==i&&a.Cost_Center==l});if(c.length>0){var d=this.transformJsonData(c[0]);this._createDynamicTable(d);this.enableDownloadButtons(null,true)}else{var a=this.getView().byId("reportTable");a.removeAllColumns();oSelectedFiltersModel.setProperty("/allSelected",false)}},setTableHeight:function(e,t){let o=window.innerHeight;let n=window.innerWidth;t.setVisibleRowCountMode("Interactive");t.setMinAutoRowCount(5);if(n<450){let e=Math.floor(o/120);t.setVisibleRowCount(e)}else{let e=Math.floor(o/80);t.setVisibleRowCount(e)}},onDownloadExcel:function(){var e=this.getView().byId("tableContainer").getItems()[0];var t=e.getModel();var o=t.getProperty("/tableRows");var n=[["Journal Type","Account","Debit","Credit"]];o.forEach(function(e){n.push([e.journalType||"",e.account||"",e.debit||"",e.credit||""])});var r=XLSX.utils.book_new();var i=XLSX.utils.aoa_to_sheet(n);XLSX.utils.book_append_sheet(r,i,"Sheet1");XLSX.writeFile(r,"tableData.xlsx")},onDownloadPdfPress:function(){var e=this.getView().byId("tableContainer");var t=e.getItems()[0];if(!t){console.error("Table not found!");return}var o=t.getModel();var n=o.getProperty("/tableRows");var r={pageSize:"A4",pageOrientation:"landscape",header:{text:"Report Periodo di Dicembre",style:"headerStyle"},footer:function(e,t){return{text:e.toString()+" of "+t,alignment:"right",style:"footerStyle"}},content:[{table:{headerRows:1,widths:["auto","auto","auto","auto"],body:[]}}],styles:{headerStyle:{fontSize:16,bold:true,alignment:"center",margin:[0,10,0,10]},columnHeaderStyle:{fontSize:12,bold:true,fillColor:"#eeeeee",alignment:"center",margin:[0,5,0,5]},cellStyle:{fontSize:10,margin:[0,5,0,5]},footerStyle:{fontSize:8,margin:[0,10,10,0]}}};r.content[0].table.body.push([{text:"Journal Type",style:"columnHeaderStyle"},{text:"Account",style:"columnHeaderStyle"},{text:"Debit",style:"columnHeaderStyle"},{text:"Credit",style:"columnHeaderStyle"}]);n.forEach(function(e){r.content[0].table.body.push([{text:e.journalType||"",style:"cellStyle"},{text:e.account||"",style:"cellStyle"},{text:e.debit||"",style:"cellStyle"},{text:e.credit||"",style:"cellStyle"}])});pdfMake.createPdf(r).download("Report.pdf")},makeTitleObjAttrBold:function(){const e=document.querySelectorAll(".sapFDynamicPageHeaderContent .sapUiVltCell.sapuiVltCell span");e.forEach(e=>{if(e&&e.textContent.includes(":")){const t=e.textContent.split(":");const o=document.createElement("span");o.style.fontWeight="bold";o.textContent=t[0]+": ";const n=document.createTextNode(t[1].trim());e.textContent="";e.appendChild(o);e.appendChild(n)}})},_sortEntitiesByDescription:function(e){return e.sort((e,t)=>e.description.localeCompare(t.description))},_elaborateEntities:function(e,t){const o=e.map((e,o)=>({ID:e,description:t[o]}));return this._sortEntitiesByDescription(o)},_sortStringArray:function(e){return e.sort((e,t)=>e.localeCompare(t))}})});
//# sourceMappingURL=Homepage.controller.js.map